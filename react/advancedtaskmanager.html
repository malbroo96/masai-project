<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Task Manager (React CDN)</title>

    <!-- React 18 + ReactDOM 18 from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel lets us write JSX in the browser for learning/demo purposes -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* ——— Basic, clean UI styles (no frameworks) ——— */
      :root {
        --bg: #0b1020;
        --card: #141a2e;
        --muted: #94a3b8;
        --text: #e2e8f0;
        --high: #ffe5e5;  /* subtle red tint background for High */
        --high-border: #ef4444; /* red border for High priority */
        --medium: #e5f0ff; /* light blue tint for Medium */
        --low: #ecfdf5;    /* light green tint for Low */
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        background: linear-gradient(180deg, #0b1020 0%, #0f172a 100%);
        color: var(--text);
      }
      .container {
        max-width: 980px;
        margin: 40px auto;
        padding: 24px;
      }
      .card {
        background: var(--card);
        border: 1px solid rgba(148, 163, 184, 0.15);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,.25);
      }
      h1 { margin: 0 0 16px; font-size: 28px; }
      p.helper { margin-top: 4px; color: var(--muted); font-size: 14px; }

      .row { display: flex; gap: 12px; flex-wrap: wrap; }
      input[type="text"], select {
        background: #0f172a;
        color: var(--text);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 10px;
        padding: 10px 12px;
        min-width: 220px;
        outline: none;
      }
      input[type="text"]:focus, select:focus { border-color: #64748b; }

      button {
        padding: 10px 14px;
        border: none;
        border-radius: 10px;
        background: #2563eb;
        color: white;
        cursor: pointer;
      }
      button.secondary { background: #334155; }
      button.danger { background: #ef4444; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }

      .filters { margin-top: 16px; gap: 12px; }
      .list { margin-top: 20px; }
      .task {
        display: grid;
        grid-template-columns: 28px 1fr 160px 110px 90px;
        gap: 10px;
        align-items: center;
        padding: 12px;
        border: 1px solid rgba(148, 163, 184, 0.15);
        border-radius: 12px;
        margin-bottom: 10px;
        background: #0f162b;
      }
      .task.high { background: var(--high); color: #1f2937; border-color: var(--high-border); }
      .task.medium { background: var(--medium); color: #0f172a; }
      .task.low { background: var(--low); color: #064e3b; }

      .title {
        font-weight: 600;
        line-height: 1.3;
        word-break: break-word;
      }
      .title.completed { text-decoration: line-through; opacity: 0.6; }

      .empty {
        margin-top: 28px;
        color: var(--muted);
        text-align: center;
      }

      @media (max-width: 720px) {
        .task { grid-template-columns: 24px 1fr 1fr 1fr 80px; }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="card">
        <h1>Advanced Task Manager</h1>
        <p class="helper">Add tasks with priorities, filter by status/priority, and keep High-priority items visually prominent.</p>

        <!-- ——— Input Row: Task Title + Priority + Add Button ——— -->
        <div id="app"></div>
      </div>
    </div>

    <script type="text/babel">
      // Pull React APIs from the global React object provided by the CDN
      const { useMemo, useState } = React;

      // Priority order map (used for sorting High -> Medium -> Low)
      const PRIORITY_ORDER = { High: 3, Medium: 2, Low: 1 };

      // Pure function to sort tasks by priority (desc) with a stable tiebreaker
      const sortTasks = (arr) => {
        return [...arr].sort((a, b) => {
          // Sort by priority weight descending
          const byPriority = PRIORITY_ORDER[b.priority] - PRIORITY_ORDER[a.priority];
          if (byPriority !== 0) return byPriority;
          // Tie-breaker: preserve creation order (older first)
          return a.createdAt - b.createdAt;
        });
      };

      function AdvancedTaskManager() {
        // ——— App State ———
        // tasks: array of task objects { id, title, priority, completed, createdAt }
        const [tasks, setTasks] = useState([]);
        // Controlled inputs for creating a task
        const [title, setTitle] = useState("");
        const [priority, setPriority] = useState("Medium");
        // Filters
        const [priorityFilter, setPriorityFilter] = useState("All"); // All | High | Medium | Low
        const [statusFilter, setStatusFilter] = useState("All"); // All | Completed | Incomplete

        // ——— Add Task ———
        const addTask = () => {
          const trimmed = title.trim();
          if (!trimmed) return; // Prevent empty titles

          const newTask = {
            id: Date.now(), // Unique id based on timestamp (good enough for this app)
            title: trimmed,
            priority, // High | Medium | Low from controlled <select>
            completed: false,
            createdAt: Date.now(),
          };

          // Use functional state update + always keep tasks sorted
          setTasks((prev) => sortTasks([...prev, newTask]));

          // Reset the input controls
          setTitle("");
          setPriority("Medium");
        };

        // ——— Toggle Completion ———
        const toggleComplete = (id) => {
          setTasks((prev) => {
            const next = prev.map((t) => (t.id === id ? { ...t, completed: !t.completed } : t));
            // Sorting is not required by completion status, but keeping it uniform is fine
            return sortTasks(next);
          });
        };

        // ——— Update Priority (in-place edit) ———
        const updatePriority = (id, nextPriority) => {
          setTasks((prev) => {
            const next = prev.map((t) => (t.id === id ? { ...t, priority: nextPriority } : t));
            // Ensure list is re-sorted whenever priority changes, per requirement
            return sortTasks(next);
          });
        };

        // ——— Delete Task ———
        const deleteTask = (id) => {
          setTasks((prev) => prev.filter((t) => t.id !== id));
        };

        // ——— Derived: filtered tasks (we keep state sorted, so filtering preserves order) ———
        const visibleTasks = useMemo(() => {
          return tasks.filter((t) => {
            const byPriority =
              priorityFilter === "All" ? true : t.priority === priorityFilter;
            const byStatus =
              statusFilter === "All"
                ? true
                : statusFilter === "Completed"
                ? t.completed
                : !t.completed; // Incomplete
            return byPriority && byStatus;
          });
        }, [tasks, priorityFilter, statusFilter]);

        // Convenience: form submit via Enter key
        const onKeyDown = (e) => {
          if (e.key === "Enter") addTask();
        };

        return (
          <>
            {/* ——— Create Task Form ——— */}
            <div className="row" style={{ marginBottom: 12 }}>
              <input
                type="text"
                placeholder="Task title"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                onKeyDown={onKeyDown}
              />

              <select value={priority} onChange={(e) => setPriority(e.target.value)}>
                <option>High</option>
                <option>Medium</option>
                <option>Low</option>
              </select>

              <button onClick={addTask} disabled={!title.trim()}>Add Task</button>
            </div>

            {/* ——— Filters ——— */}
            <div className="row filters">
              {/* Filter by Priority */}
              <select value={priorityFilter} onChange={(e) => setPriorityFilter(e.target.value)}>
                <option value="All">All Priorities</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
              </select>

              {/* Filter by Completion */}
              <select value={statusFilter} onChange={(e) => setStatusFilter(e.target.value)}>
                <option value="All">All Statuses</option>
                <option value="Completed">Completed</option>
                <option value="Incomplete">Incomplete</option>
              </select>

              {/* Optional: Clear completed to keep list tidy */}
              <button
                className="secondary"
                onClick={() => setTasks((prev) => prev.filter((t) => !t.completed))}
                disabled={!tasks.some((t) => t.completed)}
              >
                Clear Completed
              </button>
            </div>

            {/* ——— Task List ——— */}
            <div className="list">
              {visibleTasks.length === 0 ? (
                <div className="empty">No tasks match your filters. Add some or change filters.</div>
              ) : (
                visibleTasks.map((t) => (
                  <div
                    key={t.id}
                    className={
                      "task " + (t.priority === "High" ? "high" : t.priority === "Medium" ? "medium" : "low")
                    }
                    title={t.priority + " priority"}
                  >
                    {/* Complete/Incomplete toggle */}
                    <input
                      type="checkbox"
                      checked={t.completed}
                      onChange={() => toggleComplete(t.id)}
                      aria-label="Toggle complete"
                    />

                    {/* Title (strike-through when completed) */}
                    <div className={"title" + (t.completed ? " completed" : "")}>{t.title}</div>

                    {/* Priority inline editor */}
                    <select
                      value={t.priority}
                      onChange={(e) => updatePriority(t.id, e.target.value)}
                      aria-label="Change priority"
                    >
                      <option>High</option>
                      <option>Medium</option>
                      <option>Low</option>
                    </select>

                    {/* Read-only status for clarity */}
                    <div>{t.completed ? "Completed" : "Incomplete"}</div>

                    {/* Delete */}
                    <button className="danger" onClick={() => deleteTask(t.id)}>Delete</button>
                  </div>
                ))
              )}
            </div>
          </>
        );
      }

      // Mount the React app
      const root = ReactDOM.createRoot(document.getElementById("app"));
      root.render(<AdvancedTaskManager />);
    </script>
  </body>
</html>
